---
title: "Metagene Network Analysis"
author: "Sara Gosline"
date: "1/31/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Network analysis 

The goal of this document is to study the larger networks that comprise the metagenes. We want to map all the metagene features to one single network.

```{r load data,message=F,echo=T,warning=F}

library(PCSF)
source("../util/synapseUtil.R")
library(dplyr)
syn<-synapseLogin()
##load in metagenes
k5  <- read.table(syn$get('syn26718017')$path,sep='\t',header=T)
k8 <- read.table(syn$get('syn26718020')$path,sep='\t',header=T)

```

## Create function to take proteins by type and map them to network

We need to keep track of two things - one is the type of feature we are handling, and the other is the weight for the network.

```{r network mapping,message=F,echo=T,warning=F}

build_run_network <- function(gene_name, gene_score, gene_type,cluster,k){
  library(amlresistancenetworks)
  wes_inds <- which(gene_type=='WES')
  rna_inds <- which(gene_type=='RNA')
  prot_inds <- which(gene_type=='Global')
  phos_inds <- which(gene_type=='Phospho')
  
  netname=paste0('k',k,'_cluster',cluster)
  
    ##rename WES
  wes_terms <- gene_score[wes_inds]
  names(wes_terms) <- gene_name[wes_inds]
  
  kin_terms <- gene_score[phos_inds]
  names(kin_terms) <- gene_name[phos_inds]
  
  prot_terms <- gene_score[prot_inds]
  names(prot_terms) <- gene_name[prot_inds]
  
  net = amlresistancenetworks::computePhosphoNetwork(phos.vals=kin_terms,prot.vals=prot_terms,gene.vals=wes_terms,fname=netname)
  return(net)
}

print("K5 Clusetrs")
k5%>%group_by(data_type)%>%summarize(numFeatures=n())


print('K8 Clusters')
k8%>%group_by(data_type)%>%summarize(numFeatures=n())
```



```{r k5 cluster analysis}
k5_nets <- k5 %>%
    mutate(k=5)%>%
    group_by(Cluster)%>%
    dplyr::mutate(net=build_run_network(feature,feature_score,data_type,Cluster,k))

```

Now we can summarize the networks for the k5 clusters

```{r k8 cluster analysis}
k8_nets <- k8 %>%
    mutate(k=8)%>%
    group_by(Cluster)%>%
    dplyr::mutate(net=build_run_network(feature,feature_score,data_type,Cluster,k))


```